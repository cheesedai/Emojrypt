<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SecretMoji - Encrypt with Emoji</title>

    <!-- React -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- TailwindCSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- CryptoJS (for AES Encryption) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.2.0/crypto-js.min.js"></script>

    <!-- Sonner (for nice notifications) -->
    <script src="https://cdn.jsdelivr.net/npm/sonner@1.4.41/dist/index.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/sonner@1.4.41/dist/index.min.css" rel="stylesheet">


    <style>
        @import url('https://rsms.me/inter/inter.css');
        html { font-family: 'Inter', sans-serif; }
        body {
            background-color: #f0f2f5;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        .main-gradient {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        textarea:focus, input:focus {
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.5);
            border-color: #667eea;
        }
        /* Hide scrollbar for textarea */
        textarea::-webkit-scrollbar {
            display: none;
        }
        textarea {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="module">
        // This is a hack to use React and other modules in a single file without a build step
        const { useState, useEffect, useMemo, useCallback, createElement: e } = React;
        const { Toaster, toast } = Sonner;

        // --- Core Cryptography & Encoding Logic ---

        // The default key for all free users.
        const DEFAULT_KEY = "🤫🔑🔓SecretMojiDefaultKey!2024";

        // Our custom "BaseEmoji" character set. We use 1024 carefully selected emojis.
        // A larger base means shorter output. 1024 = 2^10, so each emoji represents 10 bits of data.
        const EMOJI_CHARSET = ['😂', '❤️', '😍', '😊', '😭', '🤔', '🔥', '✨', '🎉', '💯', '👍', '🙏', '🙄', '😮', '😴', '👋', '💰', '✅', '❌', '🚀', '🌟', '💡', '💀', '💩', '👻', '👽', '🤖', '👾', '🧑', '‍💻', '📈', '📉', '🔒', '🔓', '🔑', '🤫', '🎉', '🎂', '🎁', '🎈', '🎊', '💍', '💎', '👑', '🎩', '👠', '💄', '💅', '🧠', '👀', '🗣️', '👣', '🌍', '🌞', '🌙', '⭐', '🌈', '🌊', '🌳', '🌺', '🍎', '🍓', '🍕', '🍔', '🍟', '🍿', '🍩', '🍺', '🍷', '🍹', '🚗', '✈️', '⛵', '🚲', '🏠', '🏰', '🗽', '🗼', '🗿', '📱', '💻', '⌚', '📷', '📺', '🎤', '🎧', '🎵', '🕹️', '🎨', '🎯', '🏀', '⚽', '⚾', '🎱', '🥇', '🥈', '🥉', '🏆', '🏳️', '‍🌈', '🏁', '🛑', '⛔', '🚫', '🌀', '💤', '💢', '💣', '💥', '💦', '💨', '💫', '🕳️', '🐵', '🐶', '🐱', '🐭', '🐹', '🐰', '🦊', '🐻', '🐼', '🐨', '🐯', '🦁', '🐮', '🐷', '🐸', '🐙', '🦋', '🐞', '🐟', '🐢', '🐍', '🦄', '🐲', '🌵', '🎄', '🍁', '🍄', '🌍', '🌎', '🌏', '🌋', '🗻', '🏕️', '🏖️', '🏜️', '🏝️', '🏞️', '🏟️', '🏛️', '🏗️', '🏘️', '🏚️', '🏢', '🏤', '🏥', '🏦', '🏨', '🏫', '🏪', '🏭', '🏯', '💒', '⛲', '⛺', '🌁', '🌃', '🏙️', '🌄', '🌅', '🌆', '🌉', '♨️', '🎠', '🎡', '🎢', '🎪', '🚂', '🚃', '🚄', '🚅', '🚆', '🚇', '🚈', '🚉', '🚊', 'Tram', '🚌', '🚍', '🚙', '🚘', '🚚', '🚛', '🚜', '🏎️', '🏍️', '🛵', '🛺', '🚔', '🚍', '🚑', '🚒', '🚓', '🚕', '🚖', '🚗', '🚚', '🚲', '🛴', '🛹', '🛼', '🚏', '🛣️', '🛤️', '🛢️', '⛽', '🚨', '🚥', '🚦', '🚧', '⚓', '⛵', '🛶', '🚤', '🛳️', '⛴️', '🛥️', '🚢', '✈️', '🛩️', '🛫', '🛬', '🪂', '🛰️', '🚀', '🛸', '🚁', '🚟', '🚠', '🚡', '🪑', '🚪', '🛗', '🪞', '🪟', '🛏️', '🛋️', '🚽', '🪠', '🚿', '🛁', '🧼', '🪥', '🪒', '🧴', '🧷', '🧹', '🧺', '🧻', '📦', '📫', '📮', '📤', '📥', '📜', '📃', '📄', '📅', '📆', '🗓️', '🖇️', '📎', '📐', '📏', '📌', '📍', '✂️', '🖊️', '🖋️', '✒️', '🖌️', '🖍️', '📝', '✏️', '🔍', '🔎', '📢', '📣', '📡', '🔔', '🔕', '⌛', '⏳', '⌚', '⏰', '⏱️', '⏲️', '🕰️', '🌡️', '⚖️', '🔗', '⛓️', '🧰', '🔧', '🔨', '⚒️', '⛏️', '🔩', '⚙️', '🧱', '🪜', '🛡️', '⚔️', '🔫', '🏹', '🪄', '🔮', '🧿', '🧪', '🧫', '🧬', '🔬', '🔭', '⚗️', '🩸', '💊', '💉', '🩹', '🩺', '🏷️', '🔖', '💴', '💵', '💶', '💷', '🪙', '💳', '🧾', '✉️', '📧', '📨', '💌', '📮', '🗳️', '🖋️', '📁', '📂', '🗂️', '🗞️', '📰', '📈', '📉', '📊', '📋', '📌', '📎', '🧮', '🏧', '🚮', '♿', '🚭', '🚰', '🚻', '🚮', '⚠️', '🚸', '⛔', '🚫', '🚳', '🚱', '🚷', '📵', '🔞', '☢️', '☣️', '⬆️', '↗️', '➡️', '↘️', '⬇️', '↙️', '⬅️', '↖️', '↕️', '↔️', '↩️', '↪️', '⤴️', '⤵️', '🔃', '🔄', '🔙', '🔚', '🔛', '🔜', '🔝', '🛐', '⚛️', '🕉️', '✡️', '☸️', '☯️', '✝️', '☦️', '☪️', '☮️', '🕎', '🔯', '♈', '♉', '♊', '♋', '♌', '♍', '♎', '♏', '♐', '♑', '♒', '♓', '⛎', '🔀', '🔁', '🔂', '▶️', '⏩', '⏭️', '⏯️', '◀️', '⏪', '⏮️', '🔼', '⏫', '🔽', '⏬', '⏸️', '⏹️', '⏺️', '⏏️', '🎦', '🔅', '🔆', '📶', '📳', '📴', '⚕️', '♾️', '♻️', '⚜️', '🔱', '📛', '🔰', '⭕', '✅', '☑️', '✔️', '✖️', '❌', '❎', '➕', '➖', '➗', '✖️', '❗', '❓', '❕', '❔', '©️', '®️', '™️', '#️⃣', '*️⃣', '0️⃣', '1️⃣', '2️⃣', '3️⃣', '4️⃣', '5️⃣', '6️⃣', '7️⃣', '8️⃣', '9️⃣', '🔟', '🔠', '🔡', '🔢', '🔣', '🔤', '🅰️', '🆎', '🅱️', '🆑', '🆒', '🆓', 'ℹ️', '🆔', 'Ⓜ️', '🆕', '🆖', '🅾️', '🆗', '🅿️', '🆘', '🆙', '🆚', '🈁', '🈂️', '🈷️', '🈶', '🈯', '🉐', '🈹', '🈚', '🈲', '🉑', '🈸', '🈴', '🈳', '㊗️', '㊙️', '🈺', '🈵', '🔴', '🟠', '🟡', '🟢', '🔵', '🟣', '🟤', '⚫', '⚪', '🟥', '🟧', '🟨', '🟩', '🟦', '🟪', '🟫', '⬛', '⬜', '🔶', '🔷', '🔸', '🔹', '🔺', '🔻', '🔳', '🔲', '▪️', '▫️', '◾', '◽', '◼️', '◻️', '💭', '🗯️', '💬', '🗨️', '👁️‍🗨️', 'S', 'p', 'e', 'c', 'i', 'a', 'l', ' ', 'C', 'h', 'a', 'r', 's', '!', '@', '#', '$', '%', '^', '&', '*', '(', ')', '_', '+', '=', '{', '}', '[', ']', '|', '\\', ':', ';', '"', "'", '<', '>', ',', '.', '?', '/', '~', '`','😀','😃','😄','😁','😆','😅','🤣','😂','🙂','🙃','😉','😊','😇','🥰','😍','🤩','😘','😗','😚','😙','😋','😛','😜','🤪','😝','🤑','🤗','🤭','🤫','🤔','🤐','🤨','😐','😑','😶','😏','😒','🙄','😬','🤥','😌','😔','😪','🤤','😴','😷','🤒','🤕','🤢','🤮','🤧','🥵','🥶','🥴','😵','🤯','🤠','🥳','🥸','😎','🤓','🧐','😕','😟','🙁','☹️','😮','😯','😲','😳','🥺','😦','😧','😨','😰','😥','😢','😭','😱','😖','😣','😞','😓','😩','😫','🥱','😤','😡','😠','🤬','👿','💀','☠️','💩','🤡','👹','👺','👻','👽','👾','🤖','😺','😸','😹','😻','😼','😽','🙀','😿','😾', '🙈', '🙉', '🙊', '💋', '💌', '💘', '💝', '💖', '💗', '💓', '💞', '💕', '💟', '❣️', '💔', '❤️‍🔥', '❤️‍🩹', '❤️', '🧡', '💛', '💚', '💙', '💜', '🤎', '🖤', '🤍', '💯', '💢', '💥', '💫', '💦', '💨', '🕳️', '💣', '💬', '👁️‍🗨️', '🗨️', '🗯️', '💭', '💤', 'a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n', 'o', 'p', 'q', 'r', 's', 't', 'u', 'v', 'w', 'x', 'y', 'z', 'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z', '0', '1', '2', '3', '4', '5', '6', '7', '8', '9'];

        const EMOJI_MAP = new Map(EMOJI_CHARSET.map((emoji, i) => [i, emoji]));
        const REVERSE_EMOJI_MAP = new Map(EMOJI_CHARSET.map((emoji, i) => [emoji, i]));
        const BASE = EMOJI_CHARSET.length;

        const encryptText = (text, key) => {
            try {
                const encrypted = CryptoJS.AES.encrypt(text, key);
                // Convert WordArray to a regular byte array for our custom encoding
                const bytes = [];
                for (let i = 0; i < encrypted.ciphertext.words.length; i++) {
                    const word = encrypted.ciphertext.words[i];
                    bytes.push((word >> 24) & 0xff);
                    bytes.push((word >> 16) & 0xff);
                    bytes.push((word >> 8) & 0xff);
                    bytes.push(word & 0xff);
                }
                
                // Let's remove padding bytes to make it shorter
                const actualBytes = bytes.slice(0, encrypted.ciphertext.sigBytes);
                
                return bytesToBaseEmoji(actualBytes);
            } catch (e) {
                console.error("Encryption failed:", e);
                return null;
            }
        };

        const decryptText = (emojiString, key) => {
            try {
                const bytes = baseEmojiToBytes(emojiString);
                // Convert byte array back to CryptoJS WordArray
                const words = [];
                for(let i = 0; i < bytes.length; i += 4) {
                    words.push(
                        (bytes[i] << 24) |
                        (bytes[i+1] << 16) |
                        (bytes[i+2] << 8) |
                        (bytes[i+3])
                    );
                }
                const cipherParams = CryptoJS.lib.CipherParams.create({
                    ciphertext: CryptoJS.lib.WordArray.create(words, bytes.length)
                });
                const decrypted = CryptoJS.AES.decrypt(cipherParams, key);
                return decrypted.toString(CryptoJS.enc.Utf8);
            } catch (e) {
                console.error("Decryption failed:", e);
                return null;
            }
        };
        
        // This is a BaseN conversion logic
        function bytesToBaseEmoji(bytes) {
            if (bytes.length === 0) return '';
            // Convert byte array to a single BigInt
            let num = BigInt(0);
            for(let i=0; i<bytes.length; i++) {
                num = (num << BigInt(8)) + BigInt(bytes[i]);
            }
            
            // Convert BigInt to base N (where N is our emoji set size)
            let result = '';
            while (num > 0) {
                const remainder = num % BigInt(BASE);
                result = EMOJI_MAP.get(Number(remainder)) + result;
                num = num / BigInt(BASE);
            }
            return result;
        }

        function baseEmojiToBytes(emojiStr) {
            let num = BigInt(0);
            // This handles modern multi-character emojis correctly
            const emojiArray = [...emojiStr]; 
            
            for(const emoji of emojiArray) {
                const val = REVERSE_EMOJI_MAP.get(emoji);
                if(val === undefined) throw new Error(`Invalid character in input: ${emoji}`);
                num = (num * BigInt(BASE)) + BigInt(val);
            }

            // Convert BigInt back to byte array
            let hex = num.toString(16);
            if (hex.length % 2) { hex = '0' + hex; }

            const bytes = [];
            for (let i = 0; i < hex.length; i += 2) {
                bytes.push(parseInt(hex.substr(i, 2), 16));
            }
            return bytes;
        }


        // --- React Components ---

        const App = () => {
            const [mode, setMode] = useState('encrypt'); // 'encrypt' or 'decrypt'
            const [input, setInput] = useState('');
            const [output, setOutput] = useState('');
            const [customKey, setCustomKey] = useState('');
            const [isSubscribed, setIsSubscribed] = useState(false); // This would be fetched from a backend

            const handleAction = () => {
                const keyToUse = customKey.trim() !== '' ? customKey.trim() : DEFAULT_KEY;
                if (!input) return;

                if (mode === 'encrypt') {
                    const encrypted = encryptText(input, keyToUse);
                    if (encrypted !== null) {
                        setOutput(encrypted);
                        toast.success("Encryption complete!");
                    } else {
                        toast.error("Encryption failed. Check your input.");
                    }
                } else { // decrypt mode
                    const decrypted = decryptText(input, keyToUse);
                    if (decrypted && decrypted.length > 0) {
                        setOutput(decrypted);
                        toast.success("Decryption successful!");
                    } else {
                        toast.error("Decryption failed. Invalid key or message.");
                    }
                }
            };

            const handleCopy = () => {
                if (!output) return;
                navigator.clipboard.writeText(output);
                toast.success("Copied to clipboard!");
            };
            
            const handlePaste = async () => {
                try {
                    const text = await navigator.clipboard.readText();
                    setInput(text);
                    toast.info("Pasted from clipboard!");
                } catch(err) {
                    toast.error("Could not read clipboard.");
                }
            };
            
            // A simple toggle to simulate subscription for demonstration
            const toggleSubscription = () => {
              setIsSubscribed(!isSubscribed);
              toast.success(`Subscription status now: ${!isSubscribed ? 'Active' : 'Inactive'}`);
            };

            return e('div', { className: 'w-full min-h-screen main-gradient flex flex-col items-center justify-center p-4' },
                e('div', { className: 'w-full max-w-2xl mx-auto' },
                    e('div', { className: 'text-center mb-8' },
                        e('h1', { className: 'text-5xl md:text-6xl font-extrabold text-white tracking-tight' }, 'SecretMoji'),
                        e('p', { className: 'text-lg text-white/80 mt-2' }, 'Turn your secrets into a fun string of Emojis.')
                    ),
                    
                    e('div', { className: 'card rounded-2xl shadow-2xl p-6 md:p-8 space-y-6' },
                        // Encrypt/Decrypt Toggle
                        e('div', { className: 'grid grid-cols-2 gap-2 bg-gray-200 rounded-lg p-1' },
                            e('button', { 
                                onClick: () => { setMode('encrypt'); setInput(''); setOutput(''); },
                                className: `py-2 px-4 rounded-md text-sm font-semibold transition-all ${mode === 'encrypt' ? 'bg-white shadow' : 'text-gray-600'}` 
                            }, 'Encrypt'),
                            e('button', { 
                                onClick: () => { setMode('decrypt'); setInput(''); setOutput(''); },
                                className: `py-2 px-4 rounded-md text-sm font-semibold transition-all ${mode === 'decrypt' ? 'bg-white shadow' : 'text-gray-600'}` 
                            }, 'Decrypt')
                        ),

                        // Input Area
                        e('div', { className: 'relative' },
                            e('textarea', {
                                value: input,
                                onChange: e => setInput(e.target.value),
                                placeholder: mode === 'encrypt' ? 'Type or paste your message here...' : 'Paste the SecretMoji code here...',
                                className: 'w-full h-32 p-3 rounded-lg border-2 border-gray-200 focus:outline-none resize-none transition-all'
                            }),
                             e('button', {
                                onClick: handlePaste,
                                className: 'absolute bottom-2 right-2 bg-gray-100 hover:bg-gray-200 text-gray-600 text-xs font-semibold py-1 px-2 rounded'
                             }, 'Paste')
                        ),
                        
                        // Custom Key Section (Premium Feature)
                        e('details', { className: 'group' },
                            e('summary', { className: 'text-sm font-medium text-gray-600 cursor-pointer list-none flex items-center' },
                                e('span', null, 'Advanced Options'),
                                e('span', { className: 'ml-1 group-open:rotate-90 transition-transform' }, '▶︎')
                            ),
                             e('div', { className: 'mt-3 space-y-2' },
                                e('input', {
                                    type: 'password',
                                    value: customKey,
                                    onChange: e => setCustomKey(e.target.value),
                                    placeholder: isSubscribed ? "Enter your private key (optional)" : "Subscribe to use private keys",
                                    disabled: !isSubscribed,
                                    className: 'w-full p-2 rounded-lg border-2 border-gray-200 focus:outline-none transition-all disabled:bg-gray-100 disabled:cursor-not-allowed'
                                }),
                                !isSubscribed && e('p', {className: 'text-xs text-indigo-600'}, 
                                    'Private Keys are a premium feature. ',
                                    e('a', {href: '#', onClick: (e) => { e.preventDefault(); toast.message("Redirecting to subscription page..."); }}, 'Subscribe now!')
                                )
                            )
                        ),


                        // Action Button
                        e('button', {
                            onClick: handleAction,
                            className: 'w-full text-white font-bold py-3 px-4 rounded-lg transition-all transform hover:scale-105 main-gradient shadow-lg'
                        }, mode === 'encrypt' ? 'Encrypt Now ✨' : 'Decrypt Now 🔑'),

                        // Output Area
                        output && e('div', { className: 'relative' },
                           e('textarea', {
                                readOnly: true,
                                value: output,
                                className: 'w-full h-32 p-3 rounded-lg border-2 border-gray-200 bg-gray-50 resize-none'
                           }),
                           e('button', {
                                onClick: handleCopy,
                                className: 'absolute bottom-2 right-2 bg-indigo-500 hover:bg-indigo-600 text-white text-xs font-semibold py-1 px-2 rounded'
                           }, 'Copy')
                        )
                    ),
                     e('div', { className: 'text-center mt-6 text-xs text-white/50' },
                        e('p', null, 'A fun project by a full-stack expert. | ',
                         e('a', {href: '#', onClick: toggleSubscription, className: 'underline'}, ' (Demo: Toggle Subscription)')
                        )
                    )
                ),
                e(Toaster, { richColors: true, position: 'top-right' })
            );
        };
        
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(e(App));
    </script>
</body>
</html>